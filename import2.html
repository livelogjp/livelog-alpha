<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>ライブをメモするLivelog</title>
</head>
<body>

<p><a href="index.html">＜</a></p>

<hr>

<h1>IMPORT</h1>

<form name="form" onsubmit="return false;">

<p>保存したJSONデータを、以下のテキストエリアにペーストして読み込んでください。</p>

<p>
<textarea name="txt" cols="30" rows="10" id="import"></textarea>
</p>

<button onclick="dataImport();">読み込み</button>

</form>

<div id="result"></div>

<hr>

<p>Developed on <a href="https://github.com/livelogjp/livelog-alpha">GitHub</a>.</p>

<script>

function $(id){return document.getElementById(id);}

//☆読み込み完了した時に結果を表示する関数
function displayResult() {
  var resultMessage = document.createElement('p');
  resultMessage.innerText = 'データが正常に読み込まれました。';
  var resultLink = document.createElement('p');
  resultLink.innerHTML = '<a href="index.html">ライブ一覧へ戻る</a>';
  $('result').innerHTML = '';
  $('result').appendChild(resultMessage);
  $('result').appendChild(resultLink);
}

function dataImport() {

  if ($('import').value == '') {
    alert('データを入力してください。');
  } else {
    var loadData = JSON.parse($('import').value);
    //オブジェクトに登録されているデータの個数を取得
    var loadDataNum = Object.keys(loadData).length;
    //localStorageのkeyを格納するための配列を生成
    var key = Object.keys(loadData);
    //localStorageのvalueを格納するための配列を生成
    var value = Object.values(loadData);
    //インポートする前にlocalStorageの中身を全削除
    window.localStorage.clear();
    //オブジェクトから読み取ったKey-ValueをlocalStorageへ保存
    for(var i=0; i<loadDataNum; i++) {
      localStorage.setItem(
        key[i],
        JSON.stringify(value[i])
      );
    }
    displayResult();
  }

}

</script>

</body>
</html>
