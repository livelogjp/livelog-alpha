<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>ライブをメモするLivelog</title>
</head>
<body>

<h1>Livelog</h1>

<hr>

<ul id="info">
</ul>

<button onclick="location.href='edit.html';">新規登録</button>
<p id="clear"></p>
<p id="export"></p>
<p id="import"><a href="import.html">インポート</a></p>

<hr>

<p>Developed on <a href="https://github.com/livelogjp/livelog-alpha">GitHub</a>.</p>

<script>

function $(id){return document.getElementById(id);}

//連想配列の値を指定した文字列で連結する関数
function arrayJoin(delimiter, object) {
  var ret = '';
  var lastkey = Object.keys(object).pop();
  for (var k in object) {
    ret += object[k] + (lastkey !== k ? delimiter : '');
  }
  return ret;
}

//☆localStorageにデータが登録されていたら一覧表示する処理
if(localStorage.length > 0) {

  //localStorageのKey-Valueを格納するための配列を生成
  var key = new Array();
  var item = new Array();

  for(var i=(localStorage.length - 1); i>=0; i--) {

    //localStorageのKey-Value値を各配列に代入
    key[i] = localStorage.key(i);
    item[i] = JSON.parse(
      localStorage.getItem(key[i])
    );

    var count =  Number(key[i].replace('live', ''));

    //artist0〜artist*の値を配列で取得
    var artistsItemLabel = Object.keys(item[i].artists);

    //アーティスト名一覧を格納するための配列を作成
    var artistsItem = [];

    //アーティスト用の配列に登録されている分だけのアーティスト名を入力
    for (j = 0; j < artistsItemLabel.length; j++) {
      var currentArtsitLabel = 'artist' + j;
      artistsItem[j] = item[i].artists[currentArtsitLabel].name;
    }

    //アーティスト名の配列をつなげて文字列に変換
    var artistsItemJoin = arrayJoin('、', artistsItem);

    //ライブ情報を表示
    $('info').innerHTML += '<li><p>' + item[i].date + '</p><p>' + item[i].title + '＠' + item[i].area + ' ' + item[i].place + '</p><p>OPEN ' + item[i].open + ' / START ' + item[i].start + '</p><p>出演：' + artistsItemJoin + '</p><p><a href="detail.html?live=' + count + '">詳細</a></p></li>';

  }

  $('clear').innerHTML += '<button onclick="allDataClear();">データクリア</button>';
  $('export').innerHTML += '<a href="export.html">エクスポート</a>';

} else {
  //データが登録されていなかったら文言を表示
  $('info').innerHTML += '<li>ライブが登録されていません。</li>';
}

//☆データを全削除する処理
function allDataClear() {
  //確認ダイアログで「OK」を押したら処理を実行
  if(window.confirm('全てのライブ情報を削除してよろしいですか？')){
    window.localStorage.clear();
    //データ削除が終わったら、情報を最新化するためにリロード
    window.location.reload();
  }
}

</script>

</body>
</html>
